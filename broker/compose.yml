services:
  # message broker
  broker:
    image: eclipse-mosquitto:2.0.20
    container_name: mosquitto
    user: 1000:1000
    volumes:
      - ./config:/mosquitto/config:ro
      - ./data:/mosquitto/data:rw
    ports: 
      - 8081:8081
  #Â Simulate Argo diffusion file BUFR event
  argo-event-diffusion:
    image: emqx/mqttx-cli:v1.11.1
    container_name: file-diffusion-event
    user: 1000:1000
    volumes:
      - ../data/event-message/bufr:/data:ro
    command: >
      sh -c "mqttx pub -h broker --debug -p 8081 -l ws -u prod-files-rw -P \"prod-files-rw\" --path / -t diffusion/files/coriolis/argo/bufr -m \"$(cat /data/bufr-creation-cloudevent.json)\""
    profiles:
      - argo-diffusion-event